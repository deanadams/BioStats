phylo.PCA <- gm.prcomp(Y.sz, phy = plethtree, GLS = TRUE)
plot(phylo.PCA, phylo = TRUE, main = "phylo PCA",
phylo.par = list(tip.labels = FALSE))
plot(phylo.PCA, phylo = TRUE, main = "phylo PCA",
phylo.par = list(node.labels = FALSE))
## Read data, phylogeny, and match the two
tree.best<-read.nexus("Data/PlethodontidTree.nex") #Maximum Credible Tree
plethdata<-read.csv("Data/meandata-CinGlutOnly.csv",row.names=1, header=TRUE )
size<-plethdata[,2];names(size)<-row.names(plethdata)
gp<-as.factor(plethdata[,1]); names(gp)<-row.names(plethdata)
# Prune tree to match taxa
plethtree<-treedata(phy = tree.best,data = plethdata, warnings = FALSE)$phy
plot(tree.best)
plot(plethtree)
axisPhylo(1)
#Relative body proportions: trait/size
Y<-plethdata[,c(3:8)]
Y<-apply(Y,2,as.numeric);row.names(Y)<-row.names(plethdata)
TL <- Y[,1]
Y.sz<-Y/size
gdf <- geomorph.data.frame(Y=Y, Y.sz=Y.sz, TL = TL, size=size,gp=gp,phy = plethtree)
gdf$Cov <- vcv.phylo(plethtree)
class(gdf) <- "rrpp.data.frame"
###################
### Analyses
#Regression: non-phylogenetic
anova(lm(TL~size))
summary(lm(TL~size))
plot(TL~size)
abline(lm(TL~size))
summary(gls(TL~size, data=data.frame(TL=TL,size=size)))
# 1: PhylogeneticRegression (PGLS)
#using GLS
df <- data.frame(TL=TL,size=size, species = names(TL), gp=gp)
bm.gls<-gls(TL~size, correlation=corBrownian(phy=plethtree, form = ~species), data= df)
summary(bm.gls)  #Here the correlation structure of the phylogeny is used
anova(bm.gls)
#using RRPP: same
pgls.res<-lm.rrpp(TL~size,data=gdf, Cov = gdf$Cov,  print.progress = FALSE)
anova(pgls.res)
pgls.res$LM$gls.coefficients
#using Independent Contrasts: same
picTL<-pic(TL, plethtree)
picSz<-pic(size, plethtree)
cor.test(picTL, picSz)
summary(lm(picTL~picSz + 0)) #Contrasts run through origin: see Garland et al. 1992
plot(picTL~picSz)
abline(lm(picTL~picSz + 0))
#Phylogenetic anova
anova(lm.rrpp(TL ~ gp, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE) )
anova(gls(TL~gp, correlation=corBrownian(phy=plethtree, form = ~species), data= df))  #same
#multivariate phy-anova/regression (even when p>N)
PGLS.reg<-lm.rrpp(Y ~ size, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE)
anova(PGLS.reg)
plot(PGLS.reg, type = "regression", predictor=size,reg.type = "RegScore")
PGLS.aov<-lm.rrpp(Y ~ gp, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE)
anova(PGLS.aov)
# 2: Phylogenetic PLS: multivariate
PLS.Y <- phylo.integration(A = Y[,1:3], A2 = Y[,4:6], phy= plethtree, print.progress = FALSE)
summary(PLS.Y)
plot(PLS.Y)
# 3: Phylogenetic ordination
rownames(Y.sz) <- 1:nrow(Y.sz)
tree2 <- plethtree;
plethtree$tip.label <- rownames(Y.sz)
PCA.w.phylo <- gm.prcomp(Y.sz, phy = plethtree) #: phylomorphospace
phylo.PCA <- gm.prcomp(Y.sz, phy = plethtree, GLS = TRUE) #phylo-PCA
plot(PCA.w.phylo, phylo = TRUE, main = "PCA.w.phylo",
phylo.par = list(node.labels = FALSE))
PCA.w.phylo <- gm.prcomp(Y.sz, phy = plethtree) #: phylomorphospace
phylo.PCA <- gm.prcomp(Y.sz, phy = plethtree, GLS = TRUE) #phylo-PCA
plot(PCA.w.phylo, phylo = TRUE, main = "PCA.w.phylo",
phylo.par = list(node.labels = FALSE))
plot(phylo.PCA, phylo = TRUE, main = "phylo PCA",
phylo.par = list(node.labels = FALSE))
plot(PCA.w.phylo, phylo = TRUE, main = "PCA.w.phylo", time.plot = TRUE)
############
# 4: Phylogenetic signal
phylosig(plethtree, TL, method="K", test=T, nsim=1000)  #phytools
physignal(gdf$TL,plethtree, print.progress = FALSE)   #geomorph
## Read data, phylogeny, and match the two
tree.best<-read.nexus("Data/PlethodontidTree.nex") #Maximum Credible Tree
plethdata<-read.csv("Data/meandata-CinGlutOnly.csv",row.names=1, header=TRUE )
size<-plethdata[,2];names(size)<-row.names(plethdata)
gp<-as.factor(plethdata[,1]); names(gp)<-row.names(plethdata)
# Prune tree to match taxa
plethtree<-treedata(phy = tree.best,data = plethdata, warnings = FALSE)$phy
plot(tree.best)
plot(plethtree)
axisPhylo(1)
#Relative body proportions: trait/size
Y<-plethdata[,c(3:8)]
Y<-apply(Y,2,as.numeric);row.names(Y)<-row.names(plethdata)
TL <- Y[,1]
Y.sz<-Y/size
gdf <- geomorph.data.frame(Y=Y, Y.sz=Y.sz, TL = TL, size=size,gp=gp,phy = plethtree)
gdf$Cov <- vcv.phylo(plethtree)
class(gdf) <- "rrpp.data.frame"
###################
### Analyses
#Regression: non-phylogenetic
anova(lm(TL~size))
summary(lm(TL~size))
plot(TL~size)
abline(lm(TL~size))
summary(gls(TL~size, data=data.frame(TL=TL,size=size)))
# 1: PhylogeneticRegression (PGLS)
#using GLS
df <- data.frame(TL=TL,size=size, species = names(TL), gp=gp)
bm.gls<-gls(TL~size, correlation=corBrownian(phy=plethtree, form = ~species), data= df)
summary(bm.gls)  #Here the correlation structure of the phylogeny is used
anova(bm.gls)
#using RRPP: same
pgls.res<-lm.rrpp(TL~size,data=gdf, Cov = gdf$Cov,  print.progress = FALSE)
anova(pgls.res)
pgls.res$LM$gls.coefficients
#using Independent Contrasts: same
picTL<-pic(TL, plethtree)
picSz<-pic(size, plethtree)
cor.test(picTL, picSz)
summary(lm(picTL~picSz + 0)) #Contrasts run through origin: see Garland et al. 1992
plot(picTL~picSz)
abline(lm(picTL~picSz + 0))
#Phylogenetic anova
anova(lm.rrpp(TL ~ gp, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE) )
anova(gls(TL~gp, correlation=corBrownian(phy=plethtree, form = ~species), data= df))  #same
#multivariate phy-anova/regression (even when p>N)
PGLS.reg<-lm.rrpp(Y ~ size, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE)
anova(PGLS.reg)
plot(PGLS.reg, type = "regression", predictor=size,reg.type = "RegScore")
PGLS.aov<-lm.rrpp(Y ~ gp, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE)
anova(PGLS.aov)
# 2: Phylogenetic PLS: multivariate
PLS.Y <- phylo.integration(A = Y[,1:3], A2 = Y[,4:6], phy= plethtree, print.progress = FALSE)
summary(PLS.Y)
plot(PLS.Y)
# 3: Phylogenetic ordination
#Note: copied tree w/ simplified names for ease of visualization
#one should retain the original names in one's dataset!
rownames(Y.sz) <- 1:nrow(Y.sz)
plethtree2 <- plethtree; plethtree2$tip.label <- rownames(Y.sz)
PCA.w.phylo <- gm.prcomp(Y.sz, phy = plethtree2) #: phylomorphospace
phylo.PCA <- gm.prcomp(Y.sz, phy = plethtree2, GLS = TRUE) #phylo-PCA
PaCA.gls <- gm.prcomp(Y.sz, phy = plethtree2, align.to.phy = TRUE, GLS = TRUE)
plot(PCA.w.phylo, phylo = TRUE, main = "PCA.w.phylo",
phylo.par = list(node.labels = FALSE))
plot(phylo.PCA, phylo = TRUE, main = "phylo PCA",
phylo.par = list(node.labels = FALSE))
plot(PaCA.gls, phylo = TRUE, main = "PaCA using GLS",
phylo.par = list(node.labels = FALSE))
PaCA.ols <- gm.prcomp(Y.gpa$coords, phy = plethspecies$phy,
align.to.phy = TRUE)
PaCA.ols <- gm.prcomp(Y.sz, phy = plethtree2,
align.to.phy = TRUE)
plot(PaCA.ols, phylo = TRUE, main = "PaCA using OLS",
phylo.par = list(node.labels = FALSE))
plot(PaCA.gls, phylo = TRUE, main = "PaCA using GLS",
phylo.par = list(node.labels = FALSE))
PaCA.gls <- gm.prcomp(Y.sz, phy = plethtree2,
align.to.phy = TRUE, GLS = TRUE) # PACA
par(mfrow=c(2,2))
plot(PCA.w.phylo, phylo = TRUE, main = "PCA.w.phylo",
phylo.par = list(node.labels = FALSE))
plot(phylo.PCA, phylo = TRUE, main = "phylo PCA",
phylo.par = list(node.labels = FALSE))
plot(PaCA.gls, phylo = TRUE, main = "PaCA",
phylo.par = list(node.labels = FALSE))
par(mfrow=c(1,1))
############
# 4: Phylogenetic signal
phylosig(plethtree, TL, method="K", test=T, nsim=1000)  #phytools
physignal(gdf$TL,plethtree, print.progress = FALSE)   #geomorph
#Multivariate
PS.shape <- physignal(A=Y,phy=plethtree,iter=999, print.progress = FALSE)
summary(PS.shape)
plot(PS.shape)
#5a: Compare Evolutionary Rates Among Clades
ER<-compare.evol.rates(A=Y, phy=plethtree,gp=gp,iter=999, print.progress = FALSE)
summary(ER)   #significantly higher rate of morphological evolution 'large' Plethodon
plot(ER)
#5b: Compare Evolutionary Rates Among Traits (multivariate)
var.gp <- c("B","A","A","B","B","B")  #head (A) vs. body (B)
EMR<-compare.multi.evol.rates(A=Y,gp=var.gp, Subset=TRUE, phy= plethtree,iter=999, print.progress = FALSE)
summary(EMR) #Limb traits evolve faster than head traits
plot(EMR)
## Compare BM vs. OU models using GEIGER
geo=get(data(geospiza))      #a smaller dataset (for time reasons)
tmp=treedata(geo$phy, geo$dat)
phy=tmp$phy; dat=tmp$data[,"tarsusL"]
plot(phy)
bm.M<-fitContinuous(phy, dat, model="BM")
ou.M<-fitContinuous(phy, dat, bounds = list(alpha = c(min = exp(-500), max = exp(2))),model="OU")
bm.M
ou.M
prob.M<-pchisq(LRT.M, 1, lower.tail=FALSE)
# Compare models: LRT & AIC
LRT.M<-(2*(ou.M$opt$lnL-bm.M$opt$lnL))
LRT.M
prob.M
bm.M$opt$aic
ou.M$opt$aic #OU does not provide a better fit: use simpler model (BM)
## Compare BM vs. OU models using GEIGER
geo=get(data(geospiza))      #a smaller dataset (for time reasons)
tmp=treedata(geo$phy, geo$dat)
phy=tmp$phy; dat=tmp$data[,"tarsusL"]
plot(phy)
bm.M<-fitContinuous(phy, dat, model="BM")
ou.M<-fitContinuous(phy, dat, bounds = list(alpha = c(min = exp(-500), max = exp(2))),model="OU")
bm.M
ou.M
# Compare models: LRT & AIC
LRT.M<-(2*(ou.M$opt$lnL-bm.M$opt$lnL))
prob.M<-pchisq(LRT.M, 1, lower.tail=FALSE)
LRT.M
prob.M
bm.M$opt$aic
ou.M$opt$aic #OU does not provide a better fit: use simpler model (BM)
library(nlme)	# Contains GLS
library(ape)	# Many phylogenetics-related analyses (see Paradis, Analysis of Phylogenetics and Evolution with R)
library(geiger) # Many evolutionary analyses
library(phytools)
library(geomorph) #contains some multivariate PCMs
library(RRPP)
plethdata<-read.csv("Data/meandata-CinGlutOnly.csv",row.names=1, header=TRUE )
size<-plethdata[,2];names(size)<-row.names(plethdata)
gp<-as.factor(plethdata[,1]); names(gp)<-row.names(plethdata)
plot(tree.best)
plot(plethtree)
axisPhylo(1)
Y<-apply(Y,2,as.numeric);row.names(Y)<-row.names(plethdata)
TL <- Y[,1]
Y.sz<-Y/size
## Read data, phylogeny, and match the two
tree.best<-read.nexus("Data/PlethodontidTree.nex") #Maximum Credible Tree
# Prune tree to match taxa
plethtree<-treedata(phy = tree.best,data = plethdata, warnings = FALSE)$phy
#Relative body proportions: trait/size
Y<-plethdata[,c(3:8)]
setwd("C:/DeanData/Teaching/EEOB590_AdvBiostat/BioStats/LabData")
## Read data, phylogeny, and match the two
tree.best<-read.nexus("Data/PlethodontidTree.nex") #Maximum Credible Tree
plethdata<-read.csv("Data/meandata-CinGlutOnly.csv",row.names=1, header=TRUE )
size<-plethdata[,2];names(size)<-row.names(plethdata)
gp<-as.factor(plethdata[,1]); names(gp)<-row.names(plethdata)
# Prune tree to match taxa
plethtree<-treedata(phy = tree.best,data = plethdata, warnings = FALSE)$phy
plot(tree.best)
plot(plethtree)
axisPhylo(1)
## Read data, phylogeny, and match the two
tree.best<-read.nexus("Data/PlethodontidTree.nex") #Maximum Credible Tree
#Relative body proportions: trait/size
Y<-plethdata[,c(3:8)]
Y<-apply(Y,2,as.numeric);row.names(Y)<-row.names(plethdata)
TL <- Y[,1]
Y.sz<-Y/size
gdf <- rrpp.data.frame(Y=Y, Y.sz=Y.sz, TL = TL, size=size,gp=gp,phy = plethtree)
gdf <- rrpp.data.frame(Y=Y, Y.sz=Y.sz, TL = TL, size=size,gp=gp)
gdf$Cov <- vcv.phylo(plethtree)
###################
### Analyses
#Regression: non-phylogenetic
anova(lm(TL~size))
summary(lm(TL~size))
plot(TL~size)
abline(lm(TL~size))
summary(gls(TL~size, data=data.frame(TL=TL,size=size)))
# 1: PhylogeneticRegression (PGLS)
#using GLS
df <- data.frame(TL=TL,size=size, species = names(TL), gp=gp)
bm.gls<-gls(TL~size, correlation=corBrownian(phy=plethtree, form = ~species), data= df)
summary(bm.gls)  #Here the correlation structure of the phylogeny is used
anova(bm.gls)
#using RRPP: same
pgls.res<-lm.rrpp(TL~size,data=gdf, Cov = gdf$Cov,  print.progress = FALSE)
anova(pgls.res)
pgls.res$LM$gls.coefficients
#using Independent Contrasts: same
picTL<-pic(TL, plethtree)
picSz<-pic(size, plethtree)
cor.test(picTL, picSz)
summary(lm(picTL~picSz + 0)) #Contrasts run through origin: see Garland et al. 1992
plot(picTL~picSz)
abline(lm(picTL~picSz + 0))
#Phylogenetic anova
anova(lm.rrpp(TL ~ gp, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE) )
anova(gls(TL~gp, correlation=corBrownian(phy=plethtree, form = ~species), data= df))  #same
#multivariate phy-anova/regression (even when p>N)
PGLS.reg<-lm.rrpp(Y ~ size, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE)
anova(PGLS.reg)
plot(PGLS.reg, type = "regression", predictor=size,reg.type = "RegScore")
PGLS.aov<-lm.rrpp(Y ~ gp, Cov = gdf$Cov, data = gdf, iter = 999, print.progress = FALSE)
anova(PGLS.aov)
# 2: Phylogenetic PLS: multivariate
PLS.Y <- phylo.integration(A = Y[,1:3], A2 = Y[,4:6], phy= plethtree, print.progress = FALSE)
summary(PLS.Y)
plot(PLS.Y)
# 3: Phylogenetic ordination
#Note: copied tree w/ simplified names for ease of visualization
#one should retain the original names in one's dataset!
rownames(Y.sz) <- 1:nrow(Y.sz)
plethtree2 <- plethtree; plethtree2$tip.label <- rownames(Y.sz)
PCA.w.phylo <- gm.prcomp(Y.sz, phy = plethtree2) #: phylomorphospace
phylo.PCA <- gm.prcomp(Y.sz, phy = plethtree2, GLS = TRUE) #phylo-PCA
PaCA.gls <- gm.prcomp(Y.sz, phy = plethtree2,
align.to.phy = TRUE, GLS = TRUE) # PACA
par(mfrow=c(2,2))
plot(PCA.w.phylo, phylo = TRUE, main = "PCA.w.phylo",
phylo.par = list(node.labels = FALSE))
plot(phylo.PCA, phylo = TRUE, main = "phylo PCA",
phylo.par = list(node.labels = FALSE))
plot(PaCA.gls, phylo = TRUE, main = "PaCA",
phylo.par = list(node.labels = FALSE))
par(mfrow=c(1,1))
############
# 4: Phylogenetic signal
phylosig(plethtree, TL, method="K", test=T, nsim=1000)  #phytools
physignal(gdf$TL,plethtree, print.progress = FALSE)   #geomorph
#Multivariate
PS.shape <- physignal(A=Y,phy=plethtree,iter=999, print.progress = FALSE)
summary(PS.shape)
plot(PS.shape)
#5a: Compare Evolutionary Rates Among Clades
ER<-compare.evol.rates(A=Y, phy=plethtree,gp=gp,iter=999, print.progress = FALSE)
summary(ER)   #significantly higher rate of morphological evolution 'large' Plethodon
plot(ER)
#5b: Compare Evolutionary Rates Among Traits (multivariate)
var.gp <- c("B","A","A","B","B","B")  #head (A) vs. body (B)
EMR<-compare.multi.evol.rates(A=Y,gp=var.gp, Subset=TRUE, phy= plethtree,iter=999, print.progress = FALSE)
summary(EMR) #Limb traits evolve faster than head traits
plot(EMR)
library(nlme)	# Contains GLS
library(ape)	# Many phylogenetics-related analyses (see Paradis, Analysis of Phylogenetics and Evolution with R)
library(geiger) # Many evolutionary analyses
library(phytools)
library(geomorph) #contains some multivariate PCMs
library(RRPP)
## Read data, phylogeny, and match the two
tree.best<-read.nexus("Data/PlethodontidTree.nex") #Maximum Credible Tree
plethdata<-read.csv("Data/meandata-CinGlutOnly.csv",row.names=1, header=TRUE )
size<-plethdata[,2];names(size)<-row.names(plethdata)
gp<-as.factor(plethdata[,1]); names(gp)<-row.names(plethdata)
# Prune tree to match taxa
plethtree<-treedata(phy = tree.best,data = plethdata, warnings = FALSE)$phy
plot(tree.best)
plot(plethtree)
axisPhylo(1)
#Relative body proportions: trait/size
Y<-plethdata[,c(3:8)]
Y<-apply(Y,2,as.numeric);row.names(Y)<-row.names(plethdata)
TL <- Y[,1]
Y.sz<-Y/size
gdf <- rrpp.data.frame(Y=Y, Y.sz=Y.sz, TL = TL, size=size,gp=gp)
gdf$Cov <- vcv.phylo(plethtree)
###################
### Analyses
#Regression: non-phylogenetic
anova(lm(TL~size))
summary(lm(TL~size))
plot(TL~size)
abline(lm(TL~size))
summary(gls(TL~size, data=data.frame(TL=TL,size=size)))
df <- data.frame(TL=TL,size=size, species = names(TL), gp=gp)
bm.gls<-gls(TL~size, correlation=corBrownian(phy=plethtree, form = ~species), data= df)
summary(bm.gls)  #Here the correlation structure of the phylogeny is used
anova(bm.gls)
pgls.res<-lm.rrpp(TL~size,data=gdf, Cov = gdf$Cov,  print.progress = FALSE)
anova(pgls.res)
pgls.res$LM$gls.coefficients
picTL<-pic(TL, plethtree)
picSz<-pic(size, plethtree)
cor.test(picTL, picSz)
summary(lm(picTL~picSz + 0)) #Contrasts run through origin: see Garland et al. 1992
plot(picTL~picSz)
abline(lm(picTL~picSz + 0))
C <- gdf$Cov
C
#####  Phylogenetic Mixed Models (Lynch 1991)
library(lme4)
C <- gdf$Cov
fm2 <- lmer(TL ~ size + (1|C), data = df)
?lmer
#Multivariate Association
library(geomorph)
library(vegan)
library(RRPP)
data(pupfish)
force(pupfish)
pupfish$CS
pupfish$Sex
pupfish$Pop
p1<-c(4,10:17, 39:56) #variables [landmarks] in Y1
Y1<-two.d.array(pupfish$coords[p1,,]) # head data as 2D matrix
Y2<-two.d.array(pupfish$coords[-p1,,]) # body data as 2D matrix
Group<-as.factor(paste(pupfish$Pop,pupfish$Sex))
Group
cols <- rep(1, 56)
cols[p1] <- 2
plotAllSpecimens(pupfish$coords, mean = FALSE, plot.param=list(pt.bg = cols)) #to show the data
?mantel
## 1: Mantel
mantel(dist(Y1),dist(Y2),permutations = 9999)
plot(dist(Y1),dist(Y2))
?mantel.partial
mantel.partial(dist(Y1),dist(Y2),dist(pupfish$CS))  #3-way Mantel
#2: RV coefficient
RV<-function(x,y,iter=999){
n<-nrow(x)
x<-scale(x,scale=FALSE); y<-scale(y,scale=FALSE)
ind <- c(list(1:n), (Map(function(x) sample.int(n, n), 1:iter)))
y.rand <- lapply(1:(iter+1), function(i) y[ind[[i]], ])
S11<-crossprod(x, x)/(n - 1)
S22<-crossprod(y, y)/(n - 1)
S12.r<-lapply(1:(iter+1), function(i) crossprod(x, y.rand[[i]])/(n - 1))
RV.r<-unlist(lapply(1:(iter+1), function(i) sum(diag(S12.r[[i]]%*%t(S12.r[[i]]))) /
sqrt(sum(diag(S11%*%S11)) * sum(diag(S22%*%S22)))))
p.val<- 1-(rank(RV.r)[1])/(iter+1)
p.val<-ifelse(p.val==0,1/(iter+1),p.val)
return(list(RV=RV.r[[1]],pvalue=p.val))
}
RV(Y1,Y2)
sqrt(RV(Y1,Y2)$RV)  #closer to a correlation
#3: PLS
pls.res<-two.b.pls(Y1,Y2)
summary(pls.res)
plot(pls.res)
pls.res$left.pls.vectors
pls.res$right.pls.vectors
hist(pls.res$random.r)
lines(pls.res$random.r[1])
pls.res$random.r[1]
# Read Data
mydata<-read.csv("data/Lab-10.Pupfish.csv",header=T)
View(mydata)
species<-as.factor(mydata[,1]); sex<-as.factor(mydata[,2])
SL<-(mydata[,3]); Y<-as.matrix(mydata[,-(1:3)])
Group<-as.factor(paste(species,sex))
Y.orig <- Y
Y<-prcomp(Y)$x
plot(dist(Y),dist(Y.orig))
rdf <- rrpp.data.frame(Y=Y, SL=SL, sex=sex, species=species)
col.gp<-rep("green",nrow(Y));   col.gp[which(species== 'FW')]<-"red"
shape.gp<-rep(21,nrow(Y));   shape.gp[which(sex== 'M')]<-22
plot(Y,pch=shape.gp,bg=col.gp,asp=1,cex=1.5)
## CVA
library(MASS)
lda.pupfish<-lda(Y,Group)
cva.pupfish<-predict(lda.pupfish,Y)
cv.scores<-cva.pupfish$x
plot(cv.scores,pch=shape.gp,bg=col.gp,asp=1,cex=1.5)
#1: equidistant groups are not represented as such
library(mvtnorm)
corr.val<-0.7
groups<-gl(3,50)
a<- rmvnorm(n=50,mean=c(-3.4,0),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
b<- rmvnorm(n=50,mean=c(3.4,0),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
c<- rmvnorm(n=50,mean=c(0,6),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
orig.data<-rbind(a,b,c)
col.gp.r<-rep("black",nrow(orig.data)); col.gp.r[which(groups== '2')]<-"red"; col.gp.r[which(groups== '3')]<-"green"
plot(orig.data,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(orig.data, groups,conf=0.95)
plot(predict(lda(orig.data,groups))$x,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(predict(lda(orig.data,groups))$x, groups,conf=0.95)
a<- rmvnorm(n=50,mean=c(-3.4,0),sigma=matrix(c(1,-1*corr.val,-1*corr.val,1),2,2))
b<- rmvnorm(n=50,mean=c(3.4,0),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
c<- rmvnorm(n=50,mean=c(0,6),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
orig.data<-rbind(a,b,c)
col.gp.r<-rep("black",nrow(orig.data)); col.gp.r[which(groups== '2')]<-"red"; col.gp.r[which(groups== '3')]<-"green"
plot(orig.data,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(orig.data, groups,conf=0.95)
plot(predict(lda(orig.data,groups))$x,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(predict(lda(orig.data,groups))$x, groups,conf=0.95)
a<- rmvnorm(n=50,mean=c(-3.4,0),sigma=matrix(c(3*1,3*corr.val,3*corr.val,3*1),2,2))
b<- rmvnorm(n=50,mean=c(3.4,0),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
c<- rmvnorm(n=50,mean=c(0,6),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
orig.data<-rbind(a,b,c)
col.gp.r<-rep("black",nrow(orig.data)); col.gp.r[which(groups== '2')]<-"red"; col.gp.r[which(groups== '3')]<-"green"
plot(orig.data,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(orig.data, groups,conf=0.95)
plot(predict(lda(orig.data,groups))$x,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(predict(lda(orig.data,groups))$x, groups,conf=0.95)
a<- rmvnorm(n=50,mean=c(-3.4,0),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
b<- rmvnorm(n=50,mean=c(3.4,0),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
c<- rmvnorm(n=50,mean=c(0,6),sigma=matrix(c(1,corr.val,corr.val,1),2,2))
orig.data<-rbind(a,b,c)
col.gp.r<-rep("black",nrow(orig.data)); col.gp.r[which(groups== '2')]<-"red"; col.gp.r[which(groups== '3')]<-"green"
plot(orig.data,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(orig.data, groups,conf=0.95)
plot(predict(lda(orig.data,groups))$x,pch=21,bg=col.gp.r,asp=1,cex=1.5)
ordiellipse(predict(lda(orig.data,groups))$x, groups,conf=0.95)
#2: CVA can generate differences even when there are none.
data.rand<-matrix(rnorm(150*150),ncol=150)
plot(data.rand,pch=21,bg=col.gp.r,asp=1,cex=1.5)
plot(predict(lda(data.rand[,1:150],groups))$x,pch=21,bg=col.gp.r,asp=1,cex=1.5)
## RDA
plot(Y,pch=shape.gp,bg=col.gp,asp=1,cex=1.5)
pupfish.rda<-rda(Y~SL+species+sex+species:sex)
rda.scores<-predict(pupfish.rda)
plot(rda.scores,pch=shape.gp,bg=col.gp,asp=1,cex=1.5,xlab="RDA 1", ylab="RDA 2")
anova(lm.rrpp(Y~SL*species*sex, data=rdf, print.progress = FALSE))$table
pupfish.rda<-rda(Y~SL+species+sex+species:sex+SL:species)
rda.scores<-predict(pupfish.rda)
plot(rda.scores,pch=shape.gp,bg=col.gp,asp=1,cex=1.5,xlab="RDA 1", ylab="RDA 2")
##change X matrix, obtain distinct plots
plot(Y,pch=shape.gp,bg=col.gp,asp=1,cex=1.5)
plot(predict(rda(Y~SL*species*sex)),pch=shape.gp,
bg=col.gp,asp=1,cex=1.5,xlab="RDA 1", ylab="RDA 2")
plot(predict(rda(Y~species*sex)),pch=shape.gp,
bg=col.gp,asp=1,cex=1.5,xlab="RDA 1", ylab="RDA 2")
pupfish.rda<-rda(Y~SL+species+sex+species:sex)
rda.scores<-predict(pupfish.rda)
plot(rda.scores,pch=shape.gp,bg=col.gp,asp=1,cex=1.5,xlab="RDA 1", ylab="RDA 2")
